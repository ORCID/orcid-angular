<main id="main">
  <ng-container *ngIf="!userNotFound">
    <app-top-bar-my-public-record-preview
      [isPublicRecord]="publicOrcid"
    ></app-top-bar-my-public-record-preview>
    <app-record-header
      *ngIf="!!publicOrcid"
      [loadingUserRecord]="loadingUserRecord"
      [isPublicRecord]="publicOrcid"
      [affiliations]="affiliations"
      [displaySideBar]="displaySideBar"
      [displayBiography]="displayBiography"
      [(recordSummaryOpen)]="recordSummaryOpen"
      [newRecordHeaderWithSummaryTogglz]="newRecordHeaderWithSummaryTogglz"
    ></app-record-header>
    <div
      class="container no-padding main-content"
      [ngClass]="{
        'main-content-shadow': recordSummaryOpen
      }"
    >
      <div class="row">
        <app-side-bar
          class="col l3 m8 s4 new-header"
          [isPublicRecord]="publicOrcid"
          [orcidId]="platform.columns8 || platform.columns4"
          [loadingUserRecord]="loadingUserRecord"
          (isSideBarEmpty)="isSideBarEmpty($event)"
          *ngIf="
            !loadingUserRecord
              ? publicOrcid
                ? !recordWithIssues &&
                  (displaySideBar || displayBiography || affiliations > 0)
                : true
              : true
          "
        >
        </app-side-bar>
        <div
          class="content"
          [ngClass]="{
            'col l9 m8 s4': !loadingUserRecord
              ? publicOrcid
                ? !recordWithIssues &&
                  (displaySideBar || displayBiography || affiliations > 0)
                : true
              : true
          }"
        >
          <app-main>
            <app-top-bar
              [isPublicRecord]="publicOrcid"
              class="row"
              [loadingUserRecord]="loadingUserRecord"
            ></app-top-bar>
            <app-side-bar
              class="col l3 m8 s4 new-header side-bar-mobile"
              [isPublicRecord]="publicOrcid"
              [hideOrcidId]="true"
              *ngIf="platform.columns8 || platform.columns4"
            >
            </app-side-bar>
            <ng-container *ngIf="!recordWithIssues">
              <section
                id="activities"
                role="region"
                [attr.aria-label]="regionActivities"
              >
                <div
                  class="activities"
                  *ngIf="!(publicOrcid && affiliations === 0)"
                >
                  <h2
                    class="activities-header orc-font-body col"
                    [ngClass]="{ 'no-public-bio': publicOrcid ? !displayBiography : false}"
                    i18n="@@shared.activities"
                  >
                    Activities
                  </h2>
                  <div class="expand-buttons">
                    <button
                      mat-button
                      color="primary"
                      type="button"
                      i18n="@@shared.expandAll"
                      (click)="switchPanelsState()"
                      *ngIf="!globalExpandState"
                      [attr.aria-label]="expandAllActivitiesArialLabel"
                    >
                      Expand all
                    </button>
                    <button
                      mat-button
                      color="primary"
                      type="button"
                      i18n="@@shared.collapseAll"
                      (click)="switchPanelsState()"
                      *ngIf="globalExpandState"
                      [attr.aria-label]="collapseAllActivitiesArialLabel"
                    >
                      Collapse all
                    </button>
                  </div>
                </div>
                <app-affiliations
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-affiliations"
                ></app-affiliations>
                <app-fundings
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-fundings"
                ></app-fundings>
                <app-research-resources
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event, 'RESEARCH_RESOURCE')"
                  id="cy-research-resources"
                ></app-research-resources>
                <app-work-stack-group
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-works"
                ></app-work-stack-group>
                <app-peer-reviews
                  [userInfo]="userInfo"
                  [isPublicRecord]="publicOrcid"
                  [expandedContent]="expandedContent"
                  (expandedContentChange)="expandedContentUpdate($event)"
                  (total)="affiliationsCount($event)"
                  id="cy-peer-reviews"
                ></app-peer-reviews>
              </section>
            </ng-container>

            <app-record-info
              *ngIf="
                publicOrcid
                  ? recordWithIssues ||
                    (!loadingUserRecord && affiliations === 0)
                  : false
              "
              [isPublicRecord]="publicOrcid"
              [displaySideBar]="displaySideBar"
              [displayBiography]="displayBiography"
              [affiliations]="affiliations"
            ></app-record-info>
            <app-statistics
              [ngClass]="{ mobile: !platform.columns12 }"
            ></app-statistics>
          </app-main>
        </div>
      </div>
    </div>
  </ng-container>
  <app-not-found *ngIf="userNotFound"></app-not-found>
</main>
