@import '../../themes/orcid-typography.scss';

:host {
  display: block;
  background: var(--orcid-color-brand-secondary-darkest, #003449);
}

.record-header {
  display: flex;
  flex-direction: column;
  width: 100%;
  max-width: 1304px;
  margin: 0 auto;
  padding: 16px 32px;
  box-sizing: border-box;
  color: var(--orcid-color-brand-white, #ffffff);
  background: var(--orcid-color-brand-secondary-darkest, #003449);
  gap: 16px;

  &.mobile {
    padding: 16px;
    text-align: center;
  }

  // Desktop Padding
  &.desktop:not(.compact):has(.names-section) {
    padding: 16px 32px;
  }
}

// ==========================================================================
// Names Section
// ==========================================================================
.names-section {
  display: flex;
  flex-direction: column;
  align-items: center;

  // Desktop Grid
  .desktop & {
    display: grid;
    // Use minmax(0, 1fr) to allow the title to shrink below its content size (for truncation)
    grid-template-columns: minmax(0, 1fr) auto;
    grid-template-areas:
      'title actions'
      'other-names other-names';
    justify-items: start;
    gap: 0;
    align-items: center;

    // Reserve space for actions
    padding-right: 0;
  }
}

.title-area {
  grid-area: title;
  width: fit-content; // Shrink to fit content for centering
  max-width: 100%;
  width: 100%;
  min-width: 0; // Allow flex/grid child to shrink

  // Truncate text
  h1 {
    margin: 0;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    max-width: 100%;
  }

  // Ensure tooltip wrapper respects width
  orcid-text-with-tooltip {
    max-width: 100%;
    overflow: hidden;
    // display: block; // Removed to allow centering (defaults to inline-block)
  }

  .desktop & {
    // Desktop specific height/line-height
    line-height: 36px;
    height: 36px;
    width: 100%; // Desktop needs full width for grid alignment
  }

  // Mobile Typography
  .mobile & {
    margin: 0 auto 8px auto; // Center box and add bottom spacing
    text-align: left; // Ensure long text starts at left

    h1 {
      // Title: 18px height and 27px line height
      font-size: 18px; // Assuming font-size needs to adjust to match height/line-height ratio or just set line-height
      line-height: 27px;
      height: 27px;
    }
  }
}

.other-names-area {
  grid-area: other-names;
  width: fit-content; // Shrink to fit content for centering
  max-width: 100%;
  display: flex;
  flex-direction: column;
  width: 100%;

  .mobile & {
    align-items: center; // Align text to center inside the centered box
    margin: 0 auto 8px auto; // Center box and add bottom spacing
  }

  .desktop & {
    align-items: flex-start;
  }

  p {
    margin: 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  // Ensure tooltip wrapper respects width
  orcid-text-with-tooltip {
    max-width: 100%;
    overflow: hidden;
    // display: block; // Removed to allow centering
  }

  .subtitle-text {
    color: #8ec2db;
  }

  .caption-text {
    color: var(--orcid-color-brand-white, #ffffff);
  }

  // Desktop Typography
  .desktop & {
    .subtitle-text {
      line-height: 21px;
    }

    .caption-text {
      line-height: 24px;
    }

    // Ensure the wrapper component doesn't add extra height
    orcid-text-with-tooltip:has(.subtitle-text) {
      height: 21px;
      line-height: 21px;
      display: block; // Ensure it behaves like a block to respect height
    }

    orcid-text-with-tooltip:has(.caption-text) {
      height: 24px;
      line-height: 24px;
      display: block;
    }
  }

  // Mobile Typography
  .mobile & {
    .subtitle-text {
      // Subtitle: 14px height and 21px line height
      font-size: 14px;
      line-height: 21px;
      height: 21px;
    }

    .caption-text {
      // Caption: 14px height and 21px line height
      font-size: 14px;
      line-height: 21px;
      height: 21px;
    }
  }

  // Spacing between subtitle and caption
  orcid-text-with-tooltip.caption-text {
    margin-top: 8px;
  }
}

.name-actions-area {
  grid-area: actions;

  // Mobile: part of the flow, centered
  .mobile & {
    margin-top: 8px;
  }

  // Desktop:
  .desktop & {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    height: 36px; // Match title height
    margin-left: 16px; // Add spacing between title and actions
  }

  .main-action-button {
    display: flex;
    align-items: center;
    height: 48px;
  }
}

.issue-area {
  grid-column: 1 / -1;
  width: 100%;
  display: flex;
  align-items: center;
  // justify-content: center; // Removed per request

  h1 {
    font-weight: normal;
    margin: 0;
    // text-align: center; // Removed per request
  }

  // Min height when content exists
  &:has(orcid-text-with-tooltip.has-text) {
    min-height: 72px; // Desktop

    .mobile & {
      min-height: 144px;
    }

    // No min-height on compact mode
    .compact & {
      min-height: auto;
    }
  }

  // Ensure visibility in compact mode if needed (though usually hidden in compact)
  // If the requirement means "display on compact mode fontsize 14", we might need to override font-size
  .compact & h1 {
    font-size: 18px;
    line-height: 21px;
  }
}

// ==========================================================================
// Divider
// ==========================================================================
.divider {
  width: 100%;
  height: 2px;
  background: var(--orcid-color-brand-secondary-dark, #085c77);
  margin: 0;
}

// ==========================================================================
// ID Section
// ==========================================================================
.id-section {
  display: flex;
  width: 100%;
  align-items: center;
  flex-wrap: wrap; // Allow wrapping on mobile

  .mobile & {
    flex-direction: column;
    justify-content: center;
    gap: 8px;
  }

  .desktop & {
    flex-wrap: nowrap;
    height: 40px; // Fixed height for desktop ID row
  }

  // Compact Mode Overrides
  .desktop.compact & {
    height: auto;
    min-height: 56px;
    align-items: flex-start; // Top align
    flex-direction: column;
    justify-content: center;
    gap: 4px;
  }

  .mobile.compact & {
    align-items: flex-start;
    text-align: left;
  }
}

.compact-title-area {
  width: 100%;

  h1 {
    margin: 0;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;

    &.mobile {
      text-align: left;
      padding-right: 48px; // Prevent overlap with absolute positioned actions
    }
  }
}

.id-area {
  display: flex;
  align-items: center;
  min-width: 0;
  flex: 1; // Grow to fill space

  .id-content {
    display: flex;
    align-items: center;
    max-width: 100%;
  }

  .mobile & {
    justify-content: center;
    width: 100%;
  }

  .mobile.compact & {
    justify-content: flex-start;
  }

  h2 {
    margin: 0;
    font-weight: 400;
  }

  // Logo sizing
  ::ng-deep img.orcid-logo {
    // Default handled by global styles or inputs, but we can enforce if needed
  }
}

.id-actions-area {
  display: flex;
  align-items: center;
  margin-left: 16px;

  .mobile & {
    margin-left: 0;
    width: 100%;
    justify-content: center;
  }
}

.summary-actions-area {
  display: flex;
  align-items: center;

  // Desktop: keep on same line (flex-wrap: nowrap on parent handles this)
  .desktop & {
    margin-left: auto; // Push to right if needed, though flex parent handles it
  }

  // Mobile:
  .mobile & {
    width: 100%;
    justify-content: center;
    min-height: 36px;
  }

  // Mobile Compact: Absolute positioning as per original design
  .mobile.compact & {
    position: absolute;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    width: auto;
    justify-content: flex-end;
    z-index: 1;
  }

  // Desktop Compact:
  .desktop.compact & {
    flex-direction: row;
    align-items: center;
    position: absolute;
    right: 0;
    top: 50%;
    transform: translateY(-50%);
  }
}

// Relative positioning for absolute children
.id-section {
  position: relative;
}

// ==========================================================================
// Loading Placeholders
// ==========================================================================
// ==========================================================================
// Loading Placeholders
// ==========================================================================
.loading-placeholder-container {
  display: flex;
  flex-direction: column;
  width: 100%;
  gap: 8px;

  .mobile & {
    align-items: center;
  }

  // Target skeleton placeholders inside text-with-tooltip
  orcid-text-with-tooltip {
    width: 100%; // Ensure tooltip wrapper takes full width

    ::ng-deep orcid-skeleton-placeholder {
      // Override inline styles from component to make them responsive via classes
      // We use !important because the component sets style="width: ...; height: ..."

      // Title placeholder
      .title-area & {
        height: 36px !important;
        width: 60% !important;

        .mobile & {
          height: 27px !important;
          width: 80% !important;
        }
      }

      // Subtitle placeholder
      // We need to target the specific text-with-tooltip instance or use nth-child on the wrapper
      // Since we can't easily distinguish them by class on the component itself without adding inputs,
      // we rely on the order in the DOM.
      .other-names-area orcid-text-with-tooltip:first-child & {
        height: 21px !important;
        width: 40% !important;

        .mobile & {
          width: 60% !important;
        }
      }

      // Caption placeholder
      .other-names-area orcid-text-with-tooltip:last-child & {
        height: 24px !important;
        width: 50% !important;

        .mobile & {
          height: 21px !important;
          width: 70% !important;
        }
      }
    }
  }

  orcid-skeleton-placeholder.compact-title-bar {
    // This class is now likely unused if we switched to text-with-tooltip input
    // But if we want to target the internal one:
    height: 27px !important;
    width: 50% !important;
  }
}

// Target skeleton placeholders inside compact-title-area text-with-tooltip
.compact-title-area {
  ::ng-deep orcid-skeleton-placeholder {
    height: 27px !important;
    width: 50% !important;
  }
}

orcid-skeleton-placeholder.id-logo-placeholder {
  width: 36px !important;
  margin-right: 8px;
  flex-shrink: 0;
  height: 36px !important; // Default

  .desktop.compact & {
    height: 24px !important;
    width: 24px !important;
  }

  .mobile & {
    height: 24px !important; // Match mobile row height approx (was 48px, user said it was too big)
    width: 24px !important;
  }
}

orcid-skeleton-placeholder.id-text-placeholder {
  width: 200px !important;
  height: 24px !important;

  .compact & {
    height: 18px !important;
  }
}

// Ensure loading placeholders for actions are positioned correctly
.summary-actions-area.loading-placeholder {
  // Mobile Compact: Absolute positioning to match loaded state
  .mobile.compact & {
    position: absolute;
    top: 50%;
    right: 0;
    transform: translateY(-50%);
    width: auto;
    justify-content: flex-end;
    z-index: 1;
  }
}

// ==========================================================================
// Shared / Utilities
// ==========================================================================
.expand_more {
  transform: rotate(90deg);
}

button.orc-ui-font-body-small {
  font-weight: 400;
}

// Button Colors
button[mat-button],
button[mat-icon-button] {
  color: var(--orcid-color-brand-white, #ffffff);

  mat-icon {
    color: var(--orcid-color-brand-white, #ffffff);
  }
}

button[mat-icon-button] {
  --mat-icon-button-icon-color: var(--orcid-color-brand-white, #ffffff);
  --mat-icon-button-hover-state-layer-color: var(
    --brand-secondary-dark,
    #085c77
  );

  &:hover,
  &:focus,
  &:active {
    background: var(--brand-secondary-dark, #085c77);
  }
}
