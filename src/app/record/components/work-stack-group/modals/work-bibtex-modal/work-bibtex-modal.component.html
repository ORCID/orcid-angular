<app-modal
  [loading]="loadingWorks"
  [noSidebar]="!(worksFromBibtex.length > 0 && !loadingWorks)"
>
  <app-modal-header>
    <ng-container i18n="@@works.importBibTex">
      Works - Import BibTeX</ng-container
    >
  </app-modal-header>
  <app-modal-side-bar *ngIf="worksFromBibtex.length > 0 && !loadingWorks">
    <ng-container id="side-bar-title">
      <a class="side-bar" i18n="@@works.workDetails" (click)="toWorkDetails()">
        Work Details
      </a>
    </ng-container>
    <ng-container id="side-bar-url-1">
      <a class="side-bar" i18n="@@works.identifiers" (click)="toIdentifiers()">
        Identifiers
      </a>
    </ng-container>
    <ng-container id="side-bar-url-2">
      <a class="side-bar" i18n="@@works.citation" (click)="toCitation()">
        Citation
      </a>
    </ng-container>
    <ng-container id="side-bar-url-3">
      <a
        class="side-bar"
        i18n="@@works.otherInformation"
        (click)="toOtherInformation()"
      >
        Other information
      </a>
    </ng-container>
    <ng-container id="side-bar-url-4">
      <a class="side-bar" i18n="@@shared.visibility" (click)="toVisibility()">
        Visibility
      </a>
    </ng-container>
  </app-modal-side-bar>
  <app-modal-footer *ngIf="worksFromBibtex.length > 0 && !loadingWorks">
    <button
      mat-raised-button
      color="primary"
      (click)="saveEvent()"
      id="import-button"
    >
      <ng-container i18n="@@works.importWork">
        Import work to your record
      </ng-container>
    </button>
    <button
      mat-stroked-button
      color="primary"
      (click)="closeEvent()"
      i18n="@@shared.cancel"
      id="cancel-button"
    >
      Cancel
    </button>
  </app-modal-footer>
  <div class="row">
    <div class="orc-font-small-print">
      <p i18n="@@works.importCitations">
        Import citations from BibTex (.bib) files, including files exported from
        Google Scholar.
      </p>
      <a
        class="underline"
        href="https://support.orcid.org/hc/en-us/articles/360006894794-Importing-works-from-a-BibTeX-file"
        i18n="@@works.moreInformation"
        rel="noopener noreferrer"
        target="_blank"
      >
        More information on importing BibTeX files into ORCID
      </a>
    </div>
  </div>
  <div class="col l4 choose-bibtex" *ngIf="worksFromBibtex.length === 0">
    <input
      #bibTexInput
      [hidden]="true"
      type="file"
      onclick="this.value=null"
      (change)="bibTexInputChange($event)"
      accept=".bib"
    />
    <button
      mat-raised-button
      color="primary"
      (click)="bibTexInput.click()"
      i18n="@@works.chooseBibTex"
    >
      Choose BibTeX file to import
    </button>
    <mat-error *ngIf="bibtexParsingError">
      {{ bibtexParsingErrorText }}
    </mat-error>
  </div>
  <ng-container *ngIf="worksFromBibtex.length > 0 && !loadingWorks">
    <div class="row">
      <h3>
        <ng-container i18n="@@works.foundInBibTex">
          Works found in BibTeX
        </ng-container>
        ({{ selectedWorks.length }})
      </h3>
      <mat-divider class="row orcid-divider"></mat-divider>
      <div class="row">
        <div class="row">
          <p>
            <mat-checkbox (change)="updateCheckAll()" [(ngModel)]="selectAll">
              <ng-container
                i18n="@@shared.selectAll"
                *ngIf="selectedWorks.length === 0"
              >
                Select all
              </ng-container>
              <ng-container *ngIf="selectedWorks.length > 0">
                ({{ selectedWorks.length }})
                <ng-container i18n="@@shared.selected">Selected</ng-container>
              </ng-container>
            </mat-checkbox>
          </p>
        </div>
      </div>
      <mat-divider class="row"></mat-divider>
      <div
        class="row"
        [formGroup]="importForm"
        *ngIf="worksFromBibtex.length > 0 && !loadingWorks"
      >
        <ng-container *ngFor="let work of worksFromBibtex">
          <div class="row work-info" [formGroupName]="work.putCode.value">
            <div class="row">
              <mat-checkbox
                (change)="updateCheck(work)"
                formControlName="checked"
              >
                <h2 class="orc-font-body" *ngIf="work?.title?.value">
                  {{ work?.title?.value }}
                </h2>
                <p class="orc-font-body-small">
                  {{ work?.journalTitle?.value }}
                </p>
                <p class="orc-font-body-small">
                  {{ work?.publicationDate | monthDayYearDateToString }}
                  <span *ngIf="work.publicationDate"> | </span>
                  {{ work?.workType?.value }}
                </p>
              </mat-checkbox>
            </div>
          </div>
          <mat-divider class="row"></mat-divider>
        </ng-container>
      </div>
    </div>
  </ng-container>
</app-modal>
