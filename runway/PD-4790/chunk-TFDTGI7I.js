import{a as Le,b as Me}from"./chunk-JV6JSP66.js";import{a as Ce}from"./chunk-SHMMQ7IV.js";import"./chunk-ITGKCWYE.js";import{d as ve}from"./chunk-VLQNEIJ2.js";import{A as U,D as we,E as b,b as me,d as E,e as M,g as P,h as ue,j as pe,k as Ee,m as ge,n as fe,q as he,r as Te,s as F,t as Ne,u as Se,v as Oe,z as Ae}from"./chunk-5O657K35.js";import{a as Re}from"./chunk-Y5LNRSTU.js";import{b as _e}from"./chunk-RAZSC2UE.js";import"./chunk-JXWF2BRY.js";import"./chunk-C6JGTCHA.js";import"./chunk-DO2YHBIV.js";import{f as se,h as ce,n as H}from"./chunk-CEHPR5GM.js";import{Ab as s,Bb as O,Cb as h,Gb as I,Hb as y,Ib as x,Qa as l,Qb as e,Sb as k,Ub as A,Vb as w,Wb as L,Yb as de,Za as v,_b as T,cb as R,da as $,ea as D,hb as le,nb as m,ob as u,pb as p,qa as ae,qb as n,rb as t,sb as S,wb as g,xb as f,yb as B}from"./chunk-HNGYNRKD.js";var Pe=["passwordInput"],Fe=["twoFactorCodeInput"],Ue=["twoFactorRecoveryCodeInput"],N=i=>({error:i});function be(i,d){i&1&&(n(0,"app-alert-message",24)(1,"div",25),e(2,"Verify your ORCID account to continue"),t(),n(3,"div",26),s(4,2),t()())}function Ge(i,d){i&1&&(n(0,"app-alert-message",24)(1,"div",26),s(2,3),t()())}function $e(i,d){if(i&1&&m(0,be,5,0,"app-alert-message",24)(1,Ge,3,0,"app-alert-message",24),i&2){let r=h();u(r.showPasswordField?0:1)}}function De(i,d){i&1&&(n(0,"mat-error",31),s(1,5),t())}function Be(i,d){i&1&&(n(0,"mat-error",31),s(1,6),t())}function ke(i,d){if(i&1&&(n(0,"div",23)(1,"mat-label",27)(2,"strong"),s(3,4),t()(),n(4,"mat-form-field",28),S(5,"input",29),t(),le(6,De,2,0,"mat-error",30),m(7,Be,2,0,"mat-error",31),t()),i&2){let r,o,a=h();l(),p("ngClass",T(6,N,((r=a.parentForm.get(a.passwordControlName))==null?null:r.invalid)&&a.passwordWasTouched)),l(4),p("formControlName",a.passwordControlName)("errorStateMatcher",a.errorMatcher)("ngClass",T(8,N,((o=a.parentForm.get(a.passwordControlName))==null?null:o.invalid)&&a.passwordWasTouched)),l(),p("ngIf",a.parentForm.get(a.passwordControlName).hasError("required")&&a.passwordWasTouched),l(),u(a.parentForm.get(a.passwordControlName).hasError("invalid")?7:-1)}}function Ve(i,d){i&1&&(n(0,"mat-hint",38),s(1,8),t())}function Je(i,d){i&1&&(n(0,"mat-error"),g(1),s(2,9),f(),t())}function Xe(i,d){i&1&&(n(0,"mat-error"),g(1),s(2,10),f(),t())}function ze(i,d){i&1&&(n(0,"mat-error"),g(1),s(2,11),f(),t())}function We(i,d){if(i&1&&(n(0,"div")(1,"mat-label",33),s(2,7),t(),n(3,"mat-form-field",34),S(4,"input",35,0),t(),n(6,"div",36)(7,"div",37),m(8,Ve,2,0,"mat-hint",38),m(9,Je,3,0,"mat-error"),m(10,Xe,3,0,"mat-error"),m(11,ze,3,0,"mat-error"),t(),n(12,"mat-hint",39),e(13),t()()()),i&2){let r,o=h(2);l(),p("ngClass",T(11,N,o.twoFactorCodeWasTouched&&o.parentForm.get(o.codeControlName).invalid)),l(2),p("hideRequiredMarker",!0),l(),p("formControlName",o.codeControlName)("errorStateMatcher",o.errorMatcher)("ngClass",T(13,N,o.twoFactorCodeWasTouched&&o.parentForm.get(o.codeControlName).invalid)),l(4),u(!o.parentForm.get(o.codeControlName).invalid||!o.twoFactorCodeWasTouched?8:-1),l(),u(o.parentForm.get(o.codeControlName).hasError("invalid")?9:-1),l(),u(o.twoFactorCodeWasTouched&&o.parentForm.get(o.codeControlName).hasError("required")?10:-1),l(),u(o.twoFactorCodeWasTouched&&(o.parentForm.get(o.codeControlName).hasError("minlength")||o.parentForm.get(o.codeControlName).hasError("maxlength"))?11:-1),l(),p("ngClass",T(15,N,o.twoFactorCodeWasTouched&&o.parentForm.get(o.codeControlName).invalid)),l(),k(" ",((r=o.parentForm.get(o.codeControlName).value)==null?null:r.length)||0,"/6 ")}}function qe(i,d){i&1&&(n(0,"mat-hint",38),s(1,13),t())}function Qe(i,d){i&1&&(n(0,"mat-error"),g(1),s(2,14),f(),t())}function Ye(i,d){i&1&&(n(0,"mat-error"),g(1),s(2,15),f(),t())}function Ke(i,d){i&1&&(n(0,"mat-error"),g(1),s(2,16),f(),t())}function je(i,d){if(i&1&&(n(0,"div")(1,"mat-label",40),s(2,12),t(),n(3,"mat-form-field",34),S(4,"input",41,1),t(),n(6,"div",36)(7,"div",37),m(8,qe,2,0,"mat-hint",38),m(9,Qe,3,0,"mat-error"),m(10,Ye,3,0,"mat-error"),m(11,Ke,3,0,"mat-error"),t(),n(12,"mat-hint",39),e(13),t()()()),i&2){let r,o=h(2);l(),p("ngClass",T(11,N,o.twoFactorRecoveryCodeWasTouched&&o.parentForm.get(o.recoveryControlName).invalid)),l(2),p("hideRequiredMarker",!0),l(),p("formControlName",o.recoveryControlName)("errorStateMatcher",o.errorMatcher)("ngClass",T(13,N,o.twoFactorRecoveryCodeWasTouched&&o.parentForm.get(o.recoveryControlName).invalid)),l(4),u(!o.parentForm.get(o.recoveryControlName).invalid||!o.twoFactorRecoveryCodeWasTouched?8:-1),l(),u(o.parentForm.get(o.recoveryControlName).hasError("invalid")?9:-1),l(),u(o.twoFactorRecoveryCodeWasTouched&&o.parentForm.get(o.recoveryControlName).hasError("required")?10:-1),l(),u(o.twoFactorRecoveryCodeWasTouched&&(o.parentForm.get(o.recoveryControlName).hasError("minlength")||o.parentForm.get(o.recoveryControlName).hasError("maxlength"))?11:-1),l(),p("ngClass",T(15,N,o.twoFactorRecoveryCodeWasTouched&&o.parentForm.get(o.recoveryControlName).invalid)),l(),k(" ",((r=o.parentForm.get(o.recoveryControlName).value)==null?null:r.length)||0,"/10 ")}}function Ze(i,d){if(i&1){let r=B();n(0,"li")(1,"div",42),g(2),s(3,19),f(),e(4,"\xA0"),n(5,"a",44),O("click",function(a){$(r);let c=h(3);return D(c.toggleRecoveryCode(a))}),s(6,20),t()()()}}function et(i,d){if(i&1){let r=B();n(0,"li")(1,"div",42),g(2),s(3,21),f(),e(4,"\xA0"),n(5,"a",44),O("click",function(a){$(r);let c=h(3);return D(c.toggleRecoveryCode(a))}),s(6,22),t()()()}}function tt(i,d){if(i&1&&(n(0,"ul",32),m(1,Ze,7,0,"li")(2,et,7,0,"li"),n(3,"li")(4,"div",42),g(5),s(6,17),f(),e(7,"\xA0"),n(8,"a",43),s(9,18),t()()()()),i&2){let r=h(2);l(),u(r.showRecoveryCode?2:1)}}function nt(i,d){if(i&1&&(m(0,We,14,17,"div")(1,je,14,17,"div"),m(2,tt,10,1,"ul",32)),i&2){let r=h();u(r.showRecoveryCode?1:0),l(2),u(r.showHelpText?2:-1)}}var V=class{constructor(){}isErrorState(d){return!!(d&&d.invalid&&d.touched)}},Ie=(()=>{class i{constructor(r){this.controlContainer=r,this.codeControlName="twoFactorCode",this.recoveryControlName="twoFactorRecoveryCode",this.passwordControlName="passwordControl",this.showAlert=!1,this.showHelpText=!0,this.showPasswordField=!0,this.showTwoFactorField=!1,this.invalidPassword=!1,this.invalidTwoFactorCode=!1,this.invalidTwoFactorRecoveryCode=!1,this.showRecoveryCode=!1,this.errorMatcher=new V}ngOnInit(){this.parentForm=this.controlContainer.control,this.updateTwoFactorValidators()}get passwordWasTouched(){return this.parentForm.get(this.passwordControlName).touched}get twoFactorCodeWasTouched(){return this.parentForm.get(this.codeControlName).touched}get twoFactorRecoveryCodeWasTouched(){return this.parentForm.get(this.recoveryControlName).touched}toggleRecoveryCode(r){r.preventDefault(),this.showRecoveryCode=!this.showRecoveryCode,this.showRecoveryCode?(setTimeout(()=>{this.twoFactorRecoveryCodeInput?.nativeElement.focus()}),this.parentForm.get(this.codeControlName)?.setValue(null),this.parentForm.get(this.recoveryControlName)?.markAsUntouched()):(setTimeout(()=>{this.twoFactorCodeInput?.nativeElement.focus()}),this.parentForm.get(this.recoveryControlName)?.setValue(null),this.parentForm.get(this.codeControlName)?.markAsUntouched()),this.updateTwoFactorValidators()}updateTwoFactorValidators(){let r=this.parentForm.get(this.codeControlName),o=this.parentForm.get(this.recoveryControlName);this.showRecoveryCode?(r?.removeValidators(E.required),o?.addValidators(E.required)):(r?.addValidators(E.required),o?.removeValidators(E.required)),r?.updateValueAndValidity({emitEvent:!1}),o?.updateValueAndValidity({emitEvent:!1})}processBackendResponse(r){let o=this.parentForm.get(this.codeControlName),a=this.parentForm.get(this.recoveryControlName),c=this.parentForm.get(this.passwordControlName);r.invalidPassword&&c?.setErrors({invalid:!0}),r.invalidTwoFactorCode&&o?.setErrors({invalid:!0}),r.invalidTwoFactorRecoveryCode&&a?.setErrors({invalid:!0}),r.twoFactorEnabled&&!r.invalidPassword&&!r.invalidTwoFactorCode&&!r.invalidTwoFactorRecoveryCode&&setTimeout(()=>{this.showRecoveryCode?this.twoFactorRecoveryCodeInput?.nativeElement.focus():this.twoFactorCodeInput?.nativeElement.focus()})}ngOnDestroy(){let r=this.parentForm.get(this.codeControlName),o=this.parentForm.get(this.recoveryControlName);r?.removeValidators(E.required),o?.removeValidators(E.required),r?.updateValueAndValidity({emitEvent:!1}),o?.updateValueAndValidity({emitEvent:!1})}static{this.\u0275fac=function(o){return new(o||i)(v(M))}}static{this.\u0275cmp=R({type:i,selectors:[["app-auth-challenge"]],viewQuery:function(o,a){if(o&1&&(I(Pe,5),I(Fe,5),I(Ue,5)),o&2){let c;y(c=x())&&(a.passwordInput=c.first),y(c=x())&&(a.twoFactorCodeInput=c.first),y(c=x())&&(a.twoFactorRecoveryCodeInput=c.first)}},inputs:{codeControlName:"codeControlName",recoveryControlName:"recoveryControlName",passwordControlName:"passwordControlName",showAlert:"showAlert",showHelpText:"showHelpText",showPasswordField:"showPasswordField",showTwoFactorField:"showTwoFactorField"},features:[de([],[{provide:M,useFactory:r=>r,deps:[[new ae,M]]}])],decls:3,vars:3,consts:()=>{let r;r=$localize`:␟378340ca3c428a788fde05e35dcf02e40f713545␟3133337408033319458: Please enter your ORCID account password, and a two-factor authentication code if requested. `;let o;o=$localize`:␟37fa222e5a5b6d9018702696271db5b7ab5ae7a4␟7473229390662392098: As two-factor authentication is currently active on your ORCID account you need to enter a 2FA code from your authentication app to continue. `;let a;a=$localize`:@@register.password␟c32ef07f8803a223a83ed17024b38e8d82292407␟1431416938026210429:Password`;let c;c=$localize`:@@account.passwordCannotBeEmpty␟f47ca373c00fb9d5f9f57243667b05f7545dba25␟3772370919402095617: Password cannot be empty `;let C;C=$localize`:␟728bd714795b209926c21f358bd60116745d74ef␟4704030968673555143:Invalid password `;let J;J=$localize`:@@account.twoPassword␟f12189d478b4dccf79327a0997dc1c538999d350␟4596373971508994025: Two-factor authentication `;let X;X=$localize`:@@account.enterTheCode␟d1df2d40acb8ca5f7423e76665333d45c5022f8a␟7352834428859853151: Enter the code from your two-factor authentication app `;let z;z=$localize`:@@ngOrcid.signin.2fa.badVerificationCode␟23a43d886a7797191cf7225bceac0e8ff9562b6b␟1682665465158076224: Invalid authentication code `;let W;W=$localize`:@@ngOrcid.signin.2fa.verificationCodeRequired␟81c47f8339cb666c5e4d3c595e4fbf2586b61e31␟5083810128795923281: Authentication code is required `;let q;q=$localize`:@@ngOrcid.signin.2fa.badVerificationCodeLength␟8d5dcf01f3bb80ba923389c89360cbeb1cec18ab␟5502755017742250135: Invalid authentication code length `;let Q;Q=$localize`:@@ngOrcid.signin.2fa.recoveryCode␟ea54b3f9563054ff6f78d2213ccf1dfbaed6f7c7␟8625174473392150189: Recovery code `;let Y;Y=$localize`:@@ngOrcid.signin.2fa.noDevice2␟b1a6261f77ea186df24c8132e93b1f1f7cbdeda6␟1582255628809743523:Enter a recovery code`;let K;K=$localize`:@@ngOrcid.signin.2fa.badRecoveryCode␟6d48884e9ec89db915f359aa51804734f25f3ad3␟6366971133477017560: Invalid recovery code `;let j;j=$localize`:@@ngOrcid.signin.2fa.recoveryCodeRequired␟f17c7c86a63dddad9423a87d56702d62ecd55cde␟4777542809874126799: Recovery code is required `;let Z;Z=$localize`:@@ngOrcid.signin.2fa.badRecoveryCodeLength␟a8549cad6389bc3d8ad40ea86c61fa730f69c99a␟8384944516554129178: Invalid recovery code length `;let ee;ee=$localize`:@@ngOrcid.signin.2fa.noDeviceOrRecovery␟b16e6187e82590ffc7c6b4d4b01e1f58c57b033b␟1462228770591737397: Don't have your device or recovery code?`;let te;te=$localize`:@@topBar.knowledge␟cad4909de18565b0015f0bc49bb831f27a13e86f␟5944480389420850932:ORCID help centre`;let ne;ne=$localize`:@@ngOrcid.signin.2fa.noDevice1␟7eae712b29e727932e952a6e7969b89bdc05579c␟3808548751779140003:Don't have your device?`;let oe;oe=$localize`:@@account.useARecoveryCode␟50df670954b46a5c8d9a2260d3648446a430b865␟4325757716866039918:Use a recovery code instead`;let ie;ie=$localize`:@@account.dontHaveYourRecoveryCodes␟48c6067c71251ee0683d836963c4edaabf267b74␟3774220887548266393: Don't have your recovery codes?`;let re;return re=$localize`:@@account.useYourAuthenticationAppInstead␟c3890e9626bbeb6a6301a618444fb7adae11c309␟7686756291450229755:Use your authentication app instead`,[["twoFactorCodeInput",""],["twoFactorRecoveryCodeInput",""],r,o,a,c,C,J,X,z,W,q,Q,Y,K,j,Z,ee,te,ne,oe,ie,re,[1,"row","mb-6","flex","flex-wrap"],["type","notice","role","dialog","aria-live","polite",1,"mb-4"],["title",""],["content","",1,"content"],["id","password-input-label",1,"orc-font-small-print","block","mb-2!",3,"ngClass"],["appearance","outline",1,"mat-form-field-min","no-hint","w-full"],["matInput","","id","password","type","password","aria-labelledby","password-input-label",3,"formControlName","errorStateMatcher","ngClass"],["class","w-full orc-font-small-print mt-2",4,"ngIf"],[1,"w-full","orc-font-small-print","mt-2"],["data-testid","help-text-links",1,"leading-5.25"],["id","2fa-input-label",1,"orc-font-small-print","font-bold!","block","mb-2!",3,"ngClass"],["appearance","outline",1,"no-hint","w-full",3,"hideRequiredMarker"],["id","twoFactorCode","type","text","inputmode","numeric","aria-labelledby","2fa-input-label","matInput","",3,"formControlName","errorStateMatcher","ngClass"],[1,"flex","orc-font-small-print"],[1,"mt-2","grow"],[1,"leading-6"],[1,"mt-2","self-center","leading-6",3,"ngClass"],["id","recovery-input-label",1,"orc-font-small-print","font-bold!","block","mb-2!",3,"ngClass"],["id","twoFactorRecoveryCode","type","text","inputmode","numeric","aria-labelledby","recovery-input-label","matInput","",3,"formControlName","errorStateMatcher","ngClass"],[1,"orc-font-body-small"],["href","https://support.orcid.org/hc/en-us","target","_blank","rel","noopener noreferrer",1,"underline"],["href","#","data-testid","recovery-toggle",1,"underline",3,"click"]]},template:function(o,a){o&1&&(m(0,$e,2,1),m(1,ke,8,10,"div",23),m(2,nt,3,2)),o&2&&(u(a.showAlert?0:-1),l(),u(a.showPasswordField?1:-1),l(),u(a.showTwoFactorField?2:-1))},dependencies:[U,Ae,Ne,Oe,Se,H,se,ce,b,we,F,me,P,fe,Ce],styles:[".grow[_ngcontent-%COMP%]{flex-grow:1}ul[_ngcontent-%COMP%]{padding-left:24px;margin-top:16px;margin-bottom:0}input[_ngcontent-%COMP%]{font-size:14px!important}","mat-hint[_ngcontent-%COMP%]{color:#000000e6}.error[_ngcontent-%COMP%]{color:#b71c1c!important}"]})}}return i})();var ot=":";function it(i,d){for(let r=1,o=1;r<i.length;r++,o++)if(d[o]==="\\")o++;else if(i[r]===ot)return r;throw new Error(`Unterminated $localize metadata block in "${d}".`)}var G=function(i,...d){if(G.translate){let o=G.translate(i,d);i=o[0],d=o[1]}let r=ye(i[0],i.raw[0]);for(let o=1;o<i.length;o++)r+=d[o-1]+ye(i[o],i.raw[o]);return r},rt=":";function ye(i,d){return d.charAt(0)===rt?i.substring(it(i,d)+1):i}globalThis.$localize=G;var Ht=(()=>{class i{constructor(r){this._fb=r,this.showAlert=!1,this.showHelpText=!0,this.showPasswordField=!0,this.showTwoFactorField=!1}ngOnInit(){this.form=this._fb.group({twoFactorCode:[null,[E.minLength(6),E.maxLength(6)]],twoFactorRecoveryCode:[null,[E.minLength(10),E.maxLength(10)]],password:["",E.required]})}static{this.\u0275fac=function(o){return new(o||i)(v(he))}}static{this.\u0275cmp=R({type:i,selectors:[["auth-challenge-page"]],decls:241,vars:9,consts:[["title","Auth Challenge Component","description","The <app-auth-challenge> component is a subform that validates user credentials (password) and manages 2FA/recovery code inputs."],["controls",""],[2,"display","grid","gap","16px","margin-bottom","24px"],[3,"ngModelChange","ngModel"],["mat-button","",2,"width","100px","height","40px","margin-left","10px",3,"click"],["examples",""],[1,"w-[537px]",3,"formGroup"],["codeControlName","twoFactorCode","recoveryControlName","twoFactorRecoveryCode","passwordControlName","password",3,"showAlert","showHelpText","showPasswordField","showTwoFactorField"],["usage","",2,"font-size","14px"],[1,"language-html"],[2,"background-color","#fff59d","color","#000"],[1,"language-typescript"],[2,"color","#666"],[1,"language-java"],["inputs",""],[2,"font-size","14px"],[2,"font-weight","bold"]],template:function(o,a){o&1&&(n(0,"app-documentation-page",0)(1,"div",1)(2,"p"),e(3,"Customize the subform to preview different configurations:"),t(),n(4,"div",2)(5,"mat-checkbox",3),L("ngModelChange",function(C){return w(a.showHelpText,C)||(a.showHelpText=C),C}),e(6," Display 2FA help text / controls "),t(),n(7,"mat-checkbox",3),L("ngModelChange",function(C){return w(a.showAlert,C)||(a.showAlert=C),C}),e(8," Display alert "),t(),n(9,"mat-checkbox",3),L("ngModelChange",function(C){return w(a.showPasswordField,C)||(a.showPasswordField=C),C}),e(10," Display password field "),t(),n(11,"mat-checkbox",3),L("ngModelChange",function(C){return w(a.showTwoFactorField,C)||(a.showTwoFactorField=C),C}),e(12," Display two-factor field "),t(),n(13,"button",4),O("click",function(){return a.form.reset()}),e(14," Reset form "),t()()(),n(15,"div",5)(16,"form",6),S(17,"app-auth-challenge",7),t()(),n(18,"div",8)(19,"p"),e(20," This component is a sub-form that must be placed inside a parent "),n(21,"code"),e(22,"[formGroup]"),t(),e(23,". It manages the UI switching and validation logic between the password field, 2FA code, and recovery code inputs. "),t(),n(24,"p"),e(25,"To implement this component, use the code highlighted in yellow."),t(),n(26,"h4"),e(27,"1. Template"),t(),n(28,"p"),e(29," Place the component inside your existing form. You can toggle the visibility of the password or 2FA fields using the boolean inputs. "),t(),n(30,"pre")(31,"code",9),e(32,`<form [formGroup]="form" (ngSubmit)="save()">
  <!-- Other inputs... -->

  `),n(33,"span",10),e(34,"<app-auth-challenge"),t(),e(35,`
    `),n(36,"span",10),e(37,'[showPasswordField]="true"'),t(),e(38,`
    `),n(39,"span",10),e(40,'[showTwoFactorField]="true"'),t(),e(41,`
    `),n(42,"span",10),e(43,'passwordControlName="password"'),t(),e(44,`
    `),n(45,"span",10),e(46,'codeControlName="twoFactorCode"'),t(),e(47,`
    `),n(48,"span",10),e(49,'recoveryControlName="twoFactorRecoveryCode"'),t(),e(50,`
    `),n(51,"span",10),e(52,'[showAlert]="true">'),t(),e(53,`
  `),n(54,"span",10),e(55,"</app-auth-challenge>"),t(),e(56,`

</form>`),t()(),n(57,"h4"),e(58,"2. Form Configuration"),t(),n(59,"p"),e(60," Initialize the controls in your parent component. Note that "),n(61,"code"),e(62,"Validators.required"),t(),e(63," for the 2FA fields is managed automatically by the child component. "),t(),n(64,"pre")(65,"code",11),e(66,`this.form = this.fb.group({
  // ... other controls
  `),n(67,"span",10),e(68,"password: ['', Validators.required],"),t(),e(69,`
  `),n(70,"span",10),e(71,"twoFactorCode: [null, [Validators.minLength(6), Validators.maxLength(6)]],"),t(),e(72,`
  `),n(73,"span",10),e(74,"twoFactorRecoveryCode: [null, [Validators.minLength(10), Validators.maxLength(10)]],"),t(),e(75,`
});`),t()(),n(76,"h4"),e(77,"3. Handling Submit & Responses"),t(),n(78,"p"),e(79," Use "),n(80,"code"),e(81,"@ViewChild"),t(),e(82," to access the component. This allows you to delegate backend error mapping (invalid password, invalid codes) and focus management. "),t(),n(83,"pre")(84,"code",11)(85,"span",10),e(86,"@ViewChild(AuthChallengeComponent) authChallengeComponent: AuthChallengeComponent;"),t(),e(87,`

save() {
  if (this.form.valid) {
    this.service.update(this.form.value).subscribe(response => {
      // Pass backend response to child to handle errors (password/2fa) or focus
      `),n(88,"span",10),e(89,"this.authChallengeComponent?.processBackendResponse(response);"),t(),e(90,`
      
      `),n(91,"span",12),e(92,"// Used when we don't know if the user"),t(),e(93,`
      `),n(94,"span",12),e(95,"// has 2fa enabled (e.g. signin)"),t(),e(96,`
      `),n(97,"span",10),e(98,"if (response.twoFactorEnabled && !response.invalidPassword) {"),t(),e(99,`
         `),n(100,"span",10),e(101,"this.twoFactorEnabled = true;"),t(),e(102,`
      `),n(103,"span",10),e(104,"}"),t(),e(105,`
    });
  }
}`),t()(),n(106,"h4"),e(107,"4. Interface Definition"),t(),n(108,"p"),e(109," The endpoint payload/response object needs to extend the "),n(110,"strong")(111,"code"),e(112,"AuthChallenge"),t()(),e(113," interface/pojo. "),t(),n(114,"pre")(115,"code",11),e(116,`export interface AuthChallenge {
  invalidPassword?: boolean;
  invalidTwoFactorCode?: boolean;
  invalidTwoFactorRecoveryCode?: boolean;
  twoFactorCode?: string;
  twoFactorRecoveryCode?: string;
  twoFactorEnabled?: boolean;
}`),t()(),n(117,"h4"),e(118,"5. Backend Implementation"),t(),n(119,"p"),e(120," The backend validation consists of two steps: verifying the password and validating the 2FA status. "),t(),n(121,"p")(122,"strong"),e(123,"1. Password Check:"),t(),e(124," First, retrieve the user profile and validate the submitted password against the stored encrypted password. If it does not match, set the "),n(125,"code"),e(126,"invalidPassword"),t(),e(127," flag and return the form. "),t(),n(128,"p")(129,"strong"),e(130,"2. 2FA Check:"),t(),e(131," If the password is valid, use the "),n(132,"code"),e(133,"TwoFactorAuthenticationManager"),t(),e(134,". If no codes are provided, it will assume a two-step flow (enabling the "),n(135,"code"),e(136,"twoFactorEnabled"),t(),e(137," flag). Otherwise, it validates the provided codes. "),t(),n(138,"pre")(139,"code",13)(140,"span",10),e(141,"ProfileEntity profile = profileEntityCacheManager.retrieve(getCurrentUserOrcid());"),t(),e(142,`

`),n(143,"span",12),e(144,"// 1. Validate Password"),t(),e(145,`
`),n(146,"span",10),e(147,"if (form.getPassword() == null || !encryptionManager.hashMatches(form.getPassword(), profile.getEncryptedPassword())) {"),t(),e(148,`
    `),n(149,"span",10),e(150,"form.setInvalidPassword(true);"),t(),e(151,`
    `),n(152,"span",10),e(153,"return form;"),t(),e(154,`
`),n(155,"span",10),e(156,"}"),t(),e(157,`

`),n(158,"span",12),e(159,"// 2. Validate 2FA"),t(),e(160,`
`),n(161,"span",10),e(162,"if (!twoFactorAuthenticationManager.validateTwoFactorAuthForm(orcid, form)) {"),t(),e(163,`
    `),n(164,"span",10),e(165,"return form;"),t(),e(166,`
`),n(167,"span",10),e(168,"}"),t()()()(),n(169,"div",14)(170,"ul",15)(171,"li")(172,"code",16),e(173,"passwordControlName"),t(),e(174,": "),n(175,"code"),e(176,"string"),t(),e(177,". The name of the form control for the password input. (default "),n(178,"code"),e(179,"'passwordControl'"),t(),e(180,") "),t(),n(181,"li")(182,"code",16),e(183,"codeControlName"),t(),e(184,": "),n(185,"code"),e(186,"string"),t(),e(187,". The name of the form control for the 6-digit authentication code. (default "),n(188,"code"),e(189,"'twoFactorCodeControl'"),t(),e(190,") "),t(),n(191,"li")(192,"code",16),e(193,"recoveryControlName"),t(),e(194,": "),n(195,"code"),e(196,"string"),t(),e(197,". The name of the form control for the 10-character recovery code. (default "),n(198,"code"),e(199,"'twoFactorRecoveryCodeControl'"),t(),e(200,") "),t(),n(201,"li")(202,"code",16),e(203,"showPasswordField"),t(),e(204,": "),n(205,"code"),e(206,"boolean"),t(),e(207,". Whether to display the password input field. (default "),n(208,"code"),e(209,"true"),t(),e(210,") "),t(),n(211,"li")(212,"code",16),e(213,"showTwoFactorField"),t(),e(214,": "),n(215,"code"),e(216,"boolean"),t(),e(217,". Whether to display the 2FA/Recovery input fields. (default "),n(218,"code"),e(219,"false"),t(),e(220,") "),t(),n(221,"li")(222,"code",16),e(223,"showAlert"),t(),e(224,": "),n(225,"code"),e(226,"boolean"),t(),e(227,". Whether to display the notice alert indicating 2FA is active or password verification is needed. (default "),n(228,"code"),e(229,"false"),t(),e(230,") "),t(),n(231,"li")(232,"code",16),e(233,"showHelpText"),t(),e(234,": "),n(235,"code"),e(236,"boolean"),t(),e(237,'. Whether to display the helper links (e.g. "Use a recovery code instead") below the inputs. (default '),n(238,"code"),e(239,"true"),t(),e(240,") "),t()()()()),o&2&&(l(5),A("ngModel",a.showHelpText),l(2),A("ngModel",a.showAlert),l(2),A("ngModel",a.showPasswordField),l(2),A("ngModel",a.showTwoFactorField),l(5),p("formGroup",a.form),l(),p("showAlert",a.showAlert)("showHelpText",a.showHelpText)("showPasswordField",a.showPasswordField)("showTwoFactorField",a.showTwoFactorField))},dependencies:[H,Te,Ee,P,ue,pe,ve,U,b,Me,Le,_e,Ie,Re,F,ge],styles:["section[_ngcontent-%COMP%]{display:grid;gap:1.25rem}app-two-factor-auth-from[_ngcontent-%COMP%]{margin-top:.5rem}pre[_ngcontent-%COMP%]{background:#1e1e1e;color:#fff;padding:.75rem 1rem;border-radius:4px;font-size:.85rem;overflow-x:auto}  mat-form-field{width:100%}  .mat-mdc-form-field-subscript-wrapper{display:none}  .mat-mdc-form-field-infix{padding-top:8px!important;padding-bottom:8px!important}  .mat-mdc-text-field-wrapper{height:40px!important}  mat-hint,   mat-label{font-size:12px}  mat-error{font-size:12px}form[_ngcontent-%COMP%]{font-size:14px}"]})}}return i})();export{Ht as AuthChallengePageComponent};
